<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>DivTube Sovereign v16.0</title>
    
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js" defer></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #020305; --sidebar: #06080c; --card: #0c0f16;
            --primary: #8b5cf6; --text: #f1f5f9; --border: rgba(255,255,255,0.06);
            --accent: #10b981; --warn: #ef4444; --reason: #3b82f6;
        }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; transition: 0.2s; }
        body { margin: 0; background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar Navigation */
        aside { width: 300px; background: var(--sidebar); border-right: 1px solid var(--border); padding: 1.5rem; display: flex; flex-direction: column; z-index: 100; }
        .logo { font-weight: 900; font-size: 1.8rem; color: var(--primary); letter-spacing: -2px; cursor: pointer; margin-bottom: 2rem; }
        .nav-item { padding: 12px; border-radius: 12px; cursor: pointer; color: rgba(255,255,255,0.4); font-weight: 700; display: flex; align-items: center; gap: 10px; margin-bottom: 5px; font-size: 0.9rem; }
        .nav-item.active { background: rgba(139, 92, 246, 0.15); color: var(--primary); border: 1px solid rgba(139, 92, 246, 0.2); }

        /* Cinema Theater */
        #page-watch { padding: 0; max-width: 100%; position: relative; }
        .theater-container { width: 100%; height: 80vh; background: #000; position: relative; }
        .theater-container iframe { width: 100%; height: 100%; border: none; }
        .watch-meta { padding: 2rem 4rem; background: linear-gradient(to top, var(--bg), transparent); margin-top: -50px; position: relative; z-index: 10; }

        /* Video Grid & Cards */
        main { flex: 1; overflow-y: auto; background: radial-gradient(circle at top right, #0d1117, #020305); }
        .page { display: none; padding: 2rem; }
        .active-page { display: block; }
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 2rem; }
        
        .card { background: var(--card); border-radius: 20px; overflow: hidden; border: 1px solid var(--border); cursor: pointer; position: relative; }
        .card img { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
        .reason-badge { position: absolute; top: 12px; left: 12px; background: rgba(0,0,0,0.8); border: 1px solid var(--reason); color: var(--reason); padding: 4px 10px; border-radius: 50px; font-size: 10px; font-weight: 900; letter-spacing: 0.5px; z-index: 5; }

        /* AI Status */
        #ai-status { position: fixed; bottom: 20px; right: 20px; background: #000; padding: 10px 20px; border-radius: 50px; border: 1px solid var(--border); font-family: 'JetBrains Mono'; font-size: 10px; color: var(--accent); z-index: 2000; }
        .tag-pill { display: inline-block; padding: 4px 10px; background: rgba(239, 68, 68, 0.1); border: 1px solid var(--warn); border-radius: 20px; font-size: 10px; margin: 2px; color: var(--warn); cursor: pointer; }
    </style>
</head>
<body>

<aside>
    <div class="logo" onclick="nav('home')">DivTube</div>
    <div id="account-pill-container" style="margin-bottom:20px;"></div>

    <div class="nav-item active" onclick="nav('home')">üì° Neural Feed</div>
    <div class="nav-item" onclick="nav('settings')">‚öôÔ∏è AI Core</div>

    <div style="margin-top:auto; padding:15px; background:rgba(255,255,255,0.02); border-radius:15px; border: 1px solid var(--border);">
        <div style="font-size:10px; font-weight:900; color:#555; margin-bottom:8px;">AI BLACKLIST</div>
        <div id="blacklist-tags"></div>
        <input type="text" id="blackInput" placeholder="+ add block..." style="width:100%; background:none; border:none; border-bottom:1px solid #333; color:white; font-size:11px; padding:5px 0; outline:none;" onkeydown="if(event.key==='Enter') addBlacklist()">
    </div>
</aside>

<div id="ai-status">NEURAL_INIT...</div>

<main>
    <div id="page-home" class="page active-page">
        <input type="text" id="searchBox" placeholder="Query the neural network..." style="width:100%; background:#000; border:1px solid var(--border); color:white; padding:20px 30px; border-radius:50px; font-size:1.1rem; outline:none; margin-bottom: 2rem;" onkeydown="if(event.key==='Enter') runAISearch()">
        <div id="grid" class="video-grid"></div>
    </div>

    <div id="page-settings" class="page">
        <h1>AI Core</h1>
        <input type="password" id="ytKey" placeholder="YouTube API Key" style="width:100%; background:#000; border:1px solid var(--border); color:white; padding:15px; border-radius:12px; margin-bottom:10px;">
        <button onclick="saveCore()" style="background:var(--primary); color:white; border:none; padding:12px 30px; border-radius:12px; cursor:pointer; font-weight:800;">SYNC ENGINE</button>
    </div>

    <div id="page-watch" class="page">
        <div class="theater-container" id="theater-mount"></div>
        <div class="watch-meta">
            <h1 id="t-title" style="margin:0 0 10px 0; font-size:2.2rem; font-weight:900;"></h1>
            <div style="display:flex; gap:15px;">
                <button onclick="nav('home')" style="background:rgba(255,255,255,0.05); border:none; color:#888; padding:12px 25px; border-radius:12px; cursor:pointer; font-weight:700;">‚Üê EXIT THEATER</button>
                <button id="like-btn" onclick="aiLearn()" style="background:var(--primary); border:none; color:white; padding:12px 30px; border-radius:12px; cursor:pointer; font-weight:800;">üî• TRAIN NEURAL WEIGHT</button>
            </div>
        </div>
    </div>
</main>

<script type="py">
import json
from js import window

class SovereignAI:
    def rank(self, candidates_json, brain_json):
        candidates = json.loads(candidates_json)
        brain = json.loads(brain_json)
        
        weights = brain.get("weights", {})
        blacklist = [b.lower() for b in brain.get("blacklist", [])]
        locks = [l.lower() for l in brain.get("locks", [])]
        
        ranked = []
        for v in candidates:
            title = v['title'].lower()
            cid = v['channelId']
            
            # 1. Neural Purge (Blacklist)
            if any(word in title for word in blacklist):
                continue
                
            # 2. Reasoning Logic
            reason = "Discovery"
            score = 1.0
            
            # Weight from channel history
            channel_weight = weights.get(cid, {}).get('points', 1.0)
            if channel_weight > 1.0:
                score *= channel_weight
                reason = f"Channel Score: {channel_weight:.1f}"
                
            # Weight from Topic Locks
            for lock in locks:
                if lock in title:
                    score *= 5.0
                    reason = f"Neural Match: '{lock}'"
            
            v['score'] = score
            v['reason'] = reason
            ranked.append(v)
            
        ranked.sort(key=lambda x: x['score'], reverse=True)
        return json.dumps(ranked)

engine = SovereignAI()
window.pyRanker = engine.rank
window.document.getElementById("ai-status").innerText = "NEURAL_ENGINE_READY"
</script>

<script>
let currentUser = localStorage.getItem('div_user_active') || 'Main';
let db = {};

function boot() {
    const raw = localStorage.getItem(`div_brain_${currentUser}`);
    db = raw ? JSON.parse(raw) : { vault: { key: "" }, brain: { weights: {}, blacklist: [], locks: [] } };
    renderUI();
}

function renderUI() {
    const bl = document.getElementById('blacklist-tags');
    bl.innerHTML = "";
    (db.brain.blacklist || []).forEach(word => {
        const s = document.createElement('span'); s.className = 'tag-pill';
        s.innerText = `√ó ${word}`;
        s.onclick = () => { db.brain.blacklist = db.brain.blacklist.filter(w => w !== word); save(); renderUI(); };
        bl.appendChild(s);
    });
}

function addBlacklist() {
    const val = document.getElementById('blackInput').value;
    if(val) {
        if(!db.brain.blacklist) db.brain.blacklist = [];
        db.brain.blacklist.push(val);
        document.getElementById('blackInput').value = "";
        save(); renderUI();
    }
}

async function runAISearch() {
    document.getElementById('ai-status').innerText = "AI_INFERENCE...";
    const q = document.getElementById('searchBox').value;
    const r = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${q}&maxResults=24&type=video&key=${db.vault.key}`);
    const d = await r.json();
    
    const raw = d.items.map(i => ({ id: i.id.videoId, channelId: i.snippet.channelId, title: i.snippet.title, thumb: i.snippet.thumbnails.high.url }));
    
    // Process through Python Engine
    const ranked = JSON.parse(window.pyRanker(JSON.stringify(raw), JSON.stringify(db.brain)));
    
    const grid = document.getElementById('grid'); grid.innerHTML = "";
    ranked.forEach(v => {
        const c = document.createElement('div'); c.className = 'card';
        c.innerHTML = `
            <div class="reason-badge">üß† ${v.reason}</div>
            <img src="${v.thumb}">
            <div style="padding:15px; font-weight:800; font-size:0.95rem; line-height:1.4;">${v.title}</div>
        `;
        c.onclick = () => openTheater(v);
        grid.appendChild(c);
    });
    document.getElementById('ai-status').innerText = "NEURAL_ENGINE_READY";
}

function openTheater(v) {
    nav('watch');
    document.getElementById('theater-mount').innerHTML = `<iframe src="https://www.youtube-nocookie.com/embed/${v.id}?autoplay=1&modestbranding=1&rel=0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
    document.getElementById('t-title').innerText = v.title;
    
    if(!db.brain.weights[v.channelId]) db.brain.weights[v.channelId] = { points: 1.0 };
    db.brain.weights[v.channelId].points += 0.5;
    save();
}

function aiLearn() {
    // Manually increase weight in the Python Engine
    const currentCid = db.brain.weights; // Simplified for demo
    // Training Logic Here...
    document.getElementById('like-btn').innerText = "‚úÖ WEIGHT UPDATED";
    save();
}

function nav(p) {
    document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active-page'));
    document.getElementById(`page-${p}`).classList.add('active-page');
    if(p !== 'watch') document.getElementById('theater-mount').innerHTML = ""; 
}

function save() { localStorage.setItem(`div_brain_${currentUser}`, JSON.stringify(db)); }
function saveCore() { db.vault.key = document.getElementById('ytKey').value; save(); location.reload(); }
boot();
</script>
</body>
</html>
